<!DOCTYPE html>
<html>
<head>
  <title> Siaini - Architectural Questionnaire </title>
  <link rel="stylesheet" type="text/css" href="final_page_style.css">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300&display=swap">
</head>
<body>
  <div class="container">
    <div class="title"> We would like to express our gratitude for your participation in our questionnaire.<br> 
        We have collected your answers and look forward to our meeting!
    </div>
    <div class="Logo_container">
        <a href="https://www.siaini.gr" target="_blank">
        <img id="website_logo" src="https://raw.githubusercontent.com/GeoBenos/Questionnaire_website/aecdb6efe8c992943e316bbe5f47d1ccf955c51f/Website/Final_page/Images/siaini_logo2.jpg" alt="Image 1">
        </a>
    </div>
    <div class="socials">
        <a class="fa fa-instagram" href="https://www.instagram.com/siaini_architecture/" target="_blank">
        </a>
        <a class="fa fa-facebook" href="https://www.facebook.com/people/Siaini-Architecture/100090058393762/" target="_blank">
        </a> 
    </div>
    <div class="message"> In the meantime you can check our socials and the official website... 
    </div>
    <!-- This is the questionnaire container -->
    <div id="questionnaire-container" style="display: none;"></div>
  </div>
  <script src="https://smtpjs.com/v3/smtp.js"></script>
  <script>
    

    function reorderQuestionnaireResults(jsonData) {
      if (!jsonData) return {}; // Return an empty object if jsonData is null
      const sortedKeys = Object.keys(jsonData).sort((a, b) => {
        const pageA = parseInt(a.match(/\d+/)[0]);
        const pageB = parseInt(b.match(/\d+/)[0]);
        return pageA - pageB;
      });

      const reorderedJSON = {};
      sortedKeys.forEach((key) => {
        reorderedJSON[key] = jsonData[key];
      });

      return reorderedJSON;
    };

    function createQuestionnaireHTML(data) {
      const container = document.getElementById('questionnaire-container');
      let html = '';

      Object.keys(data).forEach((pageKey) => {
        html += `<div class="page">`;

        // Properly escape control characters before parsing JSON data
        const pageData = JSON.parse(data[pageKey].replace(/\\n/g, '\\n').replace(/\\"/g, '\\"'));
        Object.keys(pageData).forEach((questionKey) => {
          const question = questionKey;
          const answer = pageData[questionKey];

          html += `<div class="question">${question}</div>`;
          html += `<div class="answer">${answer}</div>`;
        });

        html += `</div>`;
      });

      container.innerHTML = html;
    }

    window.onload = function () {
      const userName = localStorage.getItem('userName');
      localStorage.removeItem('userName');
      localStorage.removeItem('selectedValue');

      const questionnaire_results = localStorage;
      const reorderedResults = reorderQuestionnaireResults(questionnaire_results);
      createQuestionnaireHTML(reorderedResults);
      const emailBody = document.getElementById('questionnaire-container').innerHTML;

      Email.send({
        Host: "smtp.elasticemail.com",
        Username: "benos.geo@gmail.com",
        Password: "D35608AE8E5D26084ACDA437A5368C28D508",
        To: "benos.geo@gmail.com",
        From: "benos.geo@gmail.com",
        Subject: "Questionnaire results: " + userName,
        Body: emailBody,
        Mime: "text/html"
      });
    };
  </script>
</body>
</html>
